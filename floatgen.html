<html>

<title>floatgen: stream 4-byte floating-point numbers from text</title>

<h1>floatgen: stream 4-byte floating-point numbers from text</h1>

<img src="floatgen.gif"><p>

This simple program reads text from standard input and outputs 4-byte "float" values,
or single-precision floating-point numbers.  It is useful for generating binary data
from scratch, or from a program that only outputs text.
These flat floating-point files can then be input into image generation programs like
<a href=http://bl831.als.lbl.gov/~jamesh/bin_stuff/noisify.html>noisify</a>
or combined with simulation data from 
<a href=http://bl831.als.lbl.gov/~jamesh/nearBragg/>nearBragg</a>.
It can also generate data to directly replace the voxel values in an electron density map.

<h2>source code and binaries</h2>
source: <a href=floatgen.c>floatgen.c</a> <p>
pre-compiled binaries: 
 <a href=floatgen.Linux>linux</a>,
 <a href=floatgen.Darwin>OSX</a>,
 <a href=floatgen.Cygwin>Windows</a>
<p>
there are no dependencies beyond the standard C 
math libraries shipped with essentailly
all modern C compilers.

<h2>example usage:</h2>

Get the program:
<pre>wget <a href=floatgen.c>http://bl831.als.lbl.gov/~jamesh/bin_stuff/floatgen.c</a></pre>
compile it
<pre>
gcc -o floatgen <a href=floatgen.c>floatgen.c</a> -lm
</pre>

Check that it works, using the unix octal-dump program:
<pre>
echo "123.456" | ./floatgen | <a href=http://man7.org/linux/man-pages/man1/od.1.html>od</a> -f
0000000   1.234560e+02
0000004
</pre>
The <a href=http://man7.org/linux/man-pages/man1/od.1.html>od</a>
 program for dumping binary values in various formats has been around in linux and unix for decades.
It should already be installed on your computer.<p>

Another mainstay linux program is 
<a href=http://man7.org/linux/man-pages/man1/gawk.1.html>awk</a>, which is useful for writing
little one-line text re-formatting programs.
We can use awk to make a 3D field of values.  In this case, a ball, 3A in radius centered
at (x,y,z) = (3.4,4.5,5.6) in a unit cell with dimensions 10, 20, 30. 
<pre>
awk 'BEGIN{for(s=0;s<32;++s)\
           for(r=0;r<32;++r)\
           for(c=0;c<32;++c){\
             x=c*10.0/32;y=r*11.0/32;z=s*12.0/32;\
             d=sqrt((x-3.4)**2+(y-4.5)**2+(z-5.6)**2);\
             print (d<3)}}' |\
cat >! <a href=3Dball.txt>3Dball.txt</a>
</pre>
You can copy-and-paste the above text to a terminal window and get the same result.
The text file 3Dball.txt is 32768 lines of "1" and "0", representing values on a 32x32x32 grid.
The value is "1" for voxels within 3 A of the point, but as you can see they are all just 
numbers in a row.<p>

What can you do with this?  Well, one thing you can do is use floatgen to convert it into a
<a href=http://www.ccp4.ac.uk/dist/html/maplib.html>CCP4 format electron density map</a>.
 Of course, we need a header, but we can get one by generating an empty map
and then hijacking that maps's contents.  I wrote a little script for doing this I call
<a href=make_maphead.com>make_maphead.com</a>:
<pre>
wget <a href=http://bl831.als.lbl.gov/~jamesh/bin_stuff/make_maphead.com>http://bl831.als.lbl.gov/~jamesh/bin_stuff/make_maphead.com</a>
chmod a+x make_maphead.com
./make_mapheaad.com -grid 32 32 32 -cell 10 11 12 90 90 90
mv header.map 3Dball.map
</pre>
Now we are ready to append the floating-point data to the header and complete the map
<pre>
cat 3Dball.txt | ./floatgen >> 3Dball.map
</pre>
And then display it with your favorite map viewing program, such as 
<a href=http://www2.mrc-lmb.cam.ac.uk/personal/pemsley/coot/>Coot</a>.
Here we generate a PDB file to mark the central x-y-z coordinate of the
ball generated in 3Dball.txt
<pre>
cat << EOF >! 3Dball.pdb
CRYST1   10.000   10.000   10.000  90.00  90.00  90.00 P 1                      
ATOM      1  OW1 WAT     1       3.400   4.500   5.600  1.00 20.00           O  
EOF
coot -p 3Dball.pdb --map 3Dball.map
</pre>
<img src=coot_3Dball.jpg><p>
You can probably think of more interesting shapes to put into the map.

<hr>
Command-line options:<br>
<dl>
<dt> none <dt>
<hr>
Author:
<ADDRESS><A HREF="mailto:JMHolton@lbl.gov">James Holton &lt;JMHolton@lbl.gov&gt;</A></ADDRESS>
<br>
</html>
